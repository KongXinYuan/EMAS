<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.evmtv.epg.mapper.TContractAdvMapper" >
  <resultMap id="BaseResultMap" type="com.evmtv.epg.entity.TContractAdv" >
    <id column="ID" property="id" jdbcType="BIGINT" />
    <result column="FContractId" property="fcontractid" jdbcType="BIGINT" />
    <result column="FAdvId" property="fadvid" jdbcType="BIGINT" />
    <result column="FDefinition" property="fdefinition" jdbcType="CHAR" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    t_contract_adv.ID, t_contract_adv.FContractId, t_contract_adv.FAdvId, t_contract_adv.FDefinition
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.evmtv.epg.entity.TContractAdvExample" >
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from t_contract_adv
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />,a.FType,c.FBranchId
    from t_contract_adv
    LEFT JOIN t_adv a ON a.ID = t_contract_adv.FAdvId
    LEFT JOIN t_contract c ON c.ID = t_contract_adv.FContractId
    where t_contract_adv.ID = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    delete from t_contract_adv
    where ID = #{id,jdbcType=BIGINT}
  </delete>
  <delete id="deleteByExample" parameterType="com.evmtv.epg.entity.TContractAdvExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    delete from t_contract_adv
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.evmtv.epg.entity.TContractAdv" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    insert into t_contract_adv (ID, FContractId, FAdvId, 
      FDefinition)
    values (#{id,jdbcType=BIGINT}, #{fcontractid,jdbcType=BIGINT}, #{fadvid,jdbcType=BIGINT}, 
      #{fdefinition,jdbcType=CHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.evmtv.epg.entity.TContractAdv" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    insert into t_contract_adv
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="fcontractid != null" >
        FContractId,
      </if>
      <if test="fadvid != null" >
        FAdvId,
      </if>
      <if test="fdefinition != null" >
        FDefinition,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="fcontractid != null" >
        #{fcontractid,jdbcType=BIGINT},
      </if>
      <if test="fadvid != null" >
        #{fadvid,jdbcType=BIGINT},
      </if>
      <if test="fdefinition != null" >
        #{fdefinition,jdbcType=CHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.evmtv.epg.entity.TContractAdvExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    select count(*) from t_contract_adv
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    update t_contract_adv
    <set >
      <if test="record.id != null" >
        ID = #{record.id,jdbcType=BIGINT},
      </if>
      <if test="record.fcontractid != null" >
        FContractId = #{record.fcontractid,jdbcType=BIGINT},
      </if>
      <if test="record.fadvid != null" >
        FAdvId = #{record.fadvid,jdbcType=BIGINT},
      </if>
      <if test="record.fdefinition != null" >
        FDefinition = #{record.fdefinition,jdbcType=CHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    update t_contract_adv
    set ID = #{record.id,jdbcType=BIGINT},
      FContractId = #{record.fcontractid,jdbcType=BIGINT},
      FAdvId = #{record.fadvid,jdbcType=BIGINT},
      FDefinition = #{record.fdefinition,jdbcType=CHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.evmtv.epg.entity.TContractAdv" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    update t_contract_adv
    <set >
      <if test="fcontractid != null" >
        FContractId = #{fcontractid,jdbcType=BIGINT},
      </if>
      <if test="fadvid != null" >
        FAdvId = #{fadvid,jdbcType=BIGINT},
      </if>
      <if test="fdefinition != null" >
        FDefinition = #{fdefinition,jdbcType=CHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.evmtv.epg.entity.TContractAdv" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Sep 08 11:51:54 CST 2013.
    -->
    update t_contract_adv
    set FContractId = #{fcontractid,jdbcType=BIGINT},
      FAdvId = #{fadvid,jdbcType=BIGINT},
      FDefinition = #{fdefinition,jdbcType=CHAR}
    where ID = #{id,jdbcType=BIGINT}
  </update>
  <!-- 根据合同id查询 -->
  <select id="selectByContractId" resultType="com.evmtv.epg.entity.TContractAdv" parameterType="java.lang.Long">
      SELECT ca.ID,ca.FDefinition,ca.FAdvId,a.FType,r.FName,r.fwidth,r.fheight,r.FPath,
			car.FResourceId,car.FSourceId,car.FOriginalResourceId,car.FEdited,car.ID carId,car.FIsUsing,
			car.FUseStartTime,car.FUseEndTime
      FROM t_contract_adv ca
      LEFT JOIN t_adv a ON ca.FAdvId = a.ID
	  LEFT JOIN t_contract_adv_resource car ON car.FContractAdvId = ca.ID
	  LEFT JOIN t_resource r ON (r.ID = car.FResourceId OR r.ID = car.FOriginalResourceId)
      WHERE ca.FContractId = #{fcontractid,jdbcType=BIGINT}
  </select>
  <!-- 根据合同id查询 -->
  <select id="selectResourceByContractId" resultType="com.evmtv.epg.entity.TContractAdv" parameterType="java.lang.Long">
      SELECT ca.ID,ca.FDefinition,ca.FAdvId,car.FResourceId,
	  car.FEdited,car.FOriginalResourceId, car.FIsOriginalResource,
	  car.FSourceId,a.FType,r.FPath
	  FROM t_contract_adv ca
	  LEFT JOIN t_adv a ON ca.FAdvId = a.ID
	  LEFT JOIN t_contract_adv_resource car ON car.FContractAdvId = ca.ID
	  LEFT JOIN t_resource r ON r.ID = car.FResourceId
	  WHERE ca.FContractId = #{fcontractid,jdbcType=BIGINT}
	  AND r.ID IS NOT NULL
  </select>
  <!-- 根据分公司id查询 -->
  <select id="selectByFbranchId" resultType="com.evmtv.epg.entity.TContractAdv" parameterType="java.lang.Long">
      SELECT ca.ID,ca.FDefinition,a.FPositionId,ca.FAdvId,a.FType,
      c.FTitle fcontractName
      FROM t_contract_adv ca
      LEFT JOIN t_adv a ON ca.FAdvId = a.ID
      LEFT JOIN t_contract c ON c.ID = ca.FContractId
	  WHERE c.FBranchid = #{fbranchid,jdbcType=BIGINT}
  </select>
  <!-- 根据分公司id查询 -->
  <select id="selectAdvByFbranchId" resultType="com.evmtv.epg.entity.TContractAdv" parameterType="java.lang.Long">
      SELECT ca.FDefinition,a.ID,a.FPositionId,ca.FAdvId,a.FType, c.FTitle fcontractName
      FROM t_contract_adv ca
      LEFT JOIN t_contract_adv_resource car ON car.FContractAdvId = ca.ID
      LEFT JOIN t_adv a ON ca.FAdvId = a.ID
      LEFT JOIN t_contract c ON c.ID = ca.FContractId
	  WHERE car.FResourceId IS NOT NULL AND c.ID IS NOT NULL
	  AND c.FEndtime > CURDATE() AND c.FBranchid=#{fbranchid,jdbcType=BIGINT}
	  GROUP BY ca.FAdvId
  </select>
  
  <!-- 根据合同id查询对象信息 -->
  <select id="selectObjectByContractId" resultType="com.evmtv.epg.entity.TContractAdv" parameterType="java.lang.Long">
      SELECT ca.ID,ca.FDefinition,ca.FAdvId,c.FStartTime,c.FEndTime,car.FUseStartTime,car.FUseEndTime
      FROM t_contract_adv ca
      LEFT JOIN t_contract c ON c.ID = ca.FContractId
	  LEFT JOIN t_contract_adv_resource car ON car.FContractAdvId = ca.ID
      WHERE car.ID = #{carid,jdbcType=BIGINT}
      GROUP BY ca.FContractId
  </select>
</mapper>